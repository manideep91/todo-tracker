<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Packing Tracker</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: linear-gradient(135deg, #EFF6FF 0%, #E0E7FF 100%); min-height: 100vh; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { background: white; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); padding: 24px; margin-bottom: 24px; }
        .header h1 { font-size: 28px; color: #1F2937; margin-bottom: 8px; }
        .header p { color: #6B7280; margin-bottom: 16px; }
        .sync-status { padding: 8px 16px; border-radius: 6px; font-size: 14px; display: inline-block; margin-bottom: 16px; }
        .sync-status.synced { background: #D1FAE5; color: #065F46; }
        .sync-status.syncing { background: #FEF3C7; color: #92400E; }
        .sync-status.error { background: #FEE2E2; color: #991B1B; }
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 16px; }
        .stat-card { background: #F9FAFB; border-radius: 8px; padding: 16px; text-align: center; }
        .stat-card.blue { background: #EFF6FF; }
        .stat-card.red { background: #FEF2F2; }
        .stat-card.yellow { background: #FEFCE8; }
        .stat-card.green { background: #F0FDF4; }
        .stat-value { font-size: 24px; font-weight: bold; margin-bottom: 4px; }
        .stat-card.blue .stat-value { color: #2563EB; }
        .stat-card.red .stat-value { color: #DC2626; }
        .stat-card.yellow .stat-value { color: #CA8A04; }
        .stat-card.green .stat-value { color: #16A34A; }
        .stat-label { font-size: 14px; color: #6B7280; }
        .buttons { display: flex; gap: 12px; margin-bottom: 24px; flex-wrap: wrap; }
        button { padding: 12px 24px; border: none; border-radius: 8px; font-size: 16px; font-weight: 500; cursor: pointer; transition: all 0.2s; }
        button:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn-primary { background: #4F46E5; color: white; }
        .btn-primary:hover:not(:disabled) { background: #4338CA; }
        .btn-secondary { background: #EA580C; color: white; }
        .btn-secondary:hover:not(:disabled) { background: #C2410C; }
        .btn-success { background: #16A34A; color: white; }
        .btn-success:hover:not(:disabled) { background: #15803D; }
        .btn-cancel { background: #9CA3AF; color: white; }
        .btn-cancel:hover { background: #6B7280; }
        .btn-small { padding: 8px 12px; font-size: 14px; }
        .categories { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 24px; }
        .category { background: white; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); overflow: hidden; }
        .category-header { background: linear-gradient(135deg, #4F46E5 0%, #7C3AED 100%); color: white; padding: 16px; display: flex; justify-content: space-between; align-items: center; }
        .category-header h2 { font-size: 20px; }
        .category-actions { display: flex; gap: 8px; }
        .icon-btn { background: rgba(255,255,255,0.2); color: white; padding: 8px; border-radius: 6px; border: none; cursor: pointer; }
        .icon-btn:hover { background: rgba(255,255,255,0.3); }
        .category-body { padding: 16px; transition: all 0.3s ease; }
        .category-body.collapsed { display: none; }
        .toggle-btn { background: rgba(255,255,255,0.2); color: white; padding: 8px 12px; border-radius: 6px; border: none; cursor: pointer; font-size: 18px; transition: transform 0.3s; }
        .toggle-btn:hover { background: rgba(255,255,255,0.3); }
        .toggle-btn.collapsed { transform: rotate(-90deg); }
        .item { display: flex; align-items: center; gap: 12px; padding: 12px; background: #F9FAFB; border-radius: 8px; margin-bottom: 12px; }
        .item-content { flex: 1; }
        .item-name { font-weight: 500; color: #1F2937; margin-bottom: 4px; }
        .item-status { padding: 4px 8px; border-radius: 4px; font-size: 12px; border: 1px solid; display: inline-block; cursor: pointer; }
        .status-tobuy { background: #FEF2F2; color: #DC2626; border-color: #FCA5A5; }
        .status-procured { background: #FEFCE8; color: #CA8A04; border-color: #FDE047; }
        .status-packed { background: #F0FDF4; color: #16A34A; border-color: #86EFAC; }
        .item-actions { display: flex; gap: 8px; }
        .item-actions button { background: transparent; border: none; color: #6B7280; cursor: pointer; padding: 4px; }
        .item-actions button:hover { color: #4F46E5; }
        .input-group { display: flex; gap: 8px; margin-bottom: 16px; }
        .input-group input { flex: 1; padding: 12px; border: 1px solid #D1D5DB; border-radius: 8px; font-size: 16px; }
        select { padding: 4px 8px; border-radius: 4px; font-size: 12px; border: 1px solid; cursor: pointer; }
        .hidden { display: none; }
        .setup-notice { background: #FEF3C7; border: 2px solid #F59E0B; border-radius: 8px; padding: 16px; margin-bottom: 24px; }
        .setup-notice h3 { color: #92400E; margin-bottom: 8px; }
        .setup-notice p { color: #78350F; line-height: 1.6; }
        @media (max-width: 768px) {
            .categories { grid-template-columns: 1fr; }
            .stats { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üá∫üá∏ Move to USA Tracker</h1>
            <p>Track your family's preparation items</p>
            <div id="sync-status" class="sync-status syncing">‚öôÔ∏è Connecting to Google Sheets...</div>
            <div class="stats">
                <div class="stat-card blue">
                    <div class="stat-value" id="total-items">0</div>
                    <div class="stat-label">Total Items</div>
                </div>
                <div class="stat-card red">
                    <div class="stat-value" id="tobuy-items">0</div>
                    <div class="stat-label">To Buy</div>
                </div>
                <div class="stat-card yellow">
                    <div class="stat-value" id="procured-items">0</div>
                    <div class="stat-label">Procured</div>
                </div>
                <div class="stat-card green">
                    <div class="stat-value" id="packed-items">0</div>
                    <div class="stat-label">Packed</div>
                </div>
            </div>
        </div>

        <div id="setup-notice" class="setup-notice">
            <h3>‚ö†Ô∏è Setup Required</h3>
            <p>Please replace <code>YOUR_SCRIPT_URL_HERE</code> in the code with your Google Apps Script Web App URL. See instructions below the page.</p>
        </div>

        <div class="buttons">
            <button class="btn-primary" onclick="showAddCategory()" id="add-cat-btn">‚ûï Add Category</button>
            <button class="btn-secondary" onclick="resetToDefault()" id="reset-btn">üîÑ Reset to Default</button>
            <button class="btn-primary" onclick="loadData()" id="refresh-btn">üîÑ Refresh Data</button>
        </div>

        <div id="add-category-form" class="hidden">
            <div class="input-group">
                <input type="text" id="new-category-name" placeholder="Category name" onkeypress="if(event.key==='Enter') addCategory()">
                <button class="btn-success" onclick="addCategory()">‚úì Add</button>
                <button class="btn-cancel" onclick="hideAddCategory()">‚úó Cancel</button>
            </div>
        </div>

        <div class="categories" id="categories-container"></div>
    </div>

    <script>
        // REPLACE THIS WITH YOUR GOOGLE APPS SCRIPT WEB APP URL
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwYnBGFfYl8bQbGZ_D_BHV377SvRqg5k_TDzdvZcDq1_Cg0nMfC5MwPbxH3ocz5RIKC2w/exec';
        
        let categories = [];
        let collapsedCategories = new Set();
        let isLoading = false;

        const defaultCategories = [
            {
                id: Date.now(),
                name: 'Documents',
                items: [
                    { id: Date.now() + 1, name: 'Passport', status: 'To Buy' },
                    { id: Date.now() + 2, name: 'Baby Birth Certificate', status: 'To Buy' },
                    { id: Date.now() + 3, name: 'Marriage Certificate', status: 'To Buy' },
                    { id: Date.now() + 4, name: 'I797B', status: 'To Buy' },
                    { id: Date.now() + 5, name: 'I9 Form', status: 'To Buy' },
                    { id: Date.now() + 6, name: 'Aadhar', status: 'To Buy' },
                    { id: Date.now() + 7, name: 'Education Certificates', status: 'To Buy' },
                    { id: Date.now() + 8, name: 'Experience Letters', status: 'To Buy' }
                ]
            },
            {
                id: Date.now() + 100,
                name: 'Groceries',
                items: [
                    { id: Date.now() + 101, name: 'Rice', status: 'To Buy' },
                    { id: Date.now() + 102, name: 'Lentils (Dal)', status: 'To Buy' },
                    { id: Date.now() + 103, name: 'Spices (Turmeric, Chili, Cumin)', status: 'To Buy' },
                    { id: Date.now() + 104, name: 'Tea/Coffee', status: 'To Buy' },
                    { id: Date.now() + 105, name: 'Pickles', status: 'To Buy' }
                ]
            },
            {
                id: Date.now() + 200,
                name: 'Kitchen Items',
                items: [
                    { id: Date.now() + 201, name: 'Pressure Cooker', status: 'To Buy' },
                    { id: Date.now() + 202, name: 'Utensils Set', status: 'To Buy' },
                    { id: Date.now() + 203, name: 'Spice Box', status: 'To Buy' }
                ]
            },
            {
                id: Date.now() + 300,
                name: 'Clothes',
                items: [
                    { id: Date.now() + 301, name: 'Leggings', status: 'To Buy' },
                    { id: Date.now() + 302, name: 'Tops', status: 'To Buy' },
                    { id: Date.now() + 303, name: 'Jeans', status: 'To Buy' }
                ]
            }
        ];

        function updateSyncStatus(status, message) {
            const statusEl = document.getElementById('sync-status');
            statusEl.className = `sync-status ${status}`;
            statusEl.textContent = message;
        }

        function setLoading(loading) {
            isLoading = loading;
            const buttons = ['add-cat-btn', 'reset-btn', 'refresh-btn'];
            buttons.forEach(id => {
                const btn = document.getElementById(id);
                if (btn) btn.disabled = loading;
            });
        }

        async function loadData() {
            if (SCRIPT_URL === 'YOUR_SCRIPT_URL_HERE') {
                updateSyncStatus('error', '‚ùå Please configure Google Sheets URL');
                categories = JSON.parse(JSON.stringify(defaultCategories));
                render();
                return;
            }

            setLoading(true);
            updateSyncStatus('syncing', 'üîÑ Loading data...');

            try {
                const response = await fetch(SCRIPT_URL + '?action=getData');
                const result = await response.json();
                
                if (result.success && result.data) {
                    categories = result.data;
                    updateSyncStatus('synced', '‚úì Synced with Google Sheets');
                } else {
                    categories = JSON.parse(JSON.stringify(defaultCategories));
                    await saveData();
                }
                render();
            } catch (error) {
                console.error('Error loading data:', error);
                updateSyncStatus('error', '‚ùå Failed to load data');
                categories = JSON.parse(JSON.stringify(defaultCategories));
                render();
            } finally {
                setLoading(false);
            }
        }

        async function saveData() {
            if (SCRIPT_URL === 'YOUR_SCRIPT_URL_HERE') {
                return;
            }

            updateSyncStatus('syncing', 'üîÑ Saving...');

            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'saveData',
                        data: categories
                    })
                });

                updateSyncStatus('synced', '‚úì Saved to Google Sheets');
                
                // Reload data after a short delay to show updates from others
                setTimeout(() => loadData(), 1000);
            } catch (error) {
                console.error('Error saving data:', error);
                updateSyncStatus('error', '‚ùå Failed to save');
            }
        }

        async function resetToDefault() {
            if (confirm('Are you sure you want to reset all data to default? This will delete all current data for everyone!')) {
                categories = JSON.parse(JSON.stringify(defaultCategories));
                await saveData();
                render();
            }
        }

        function showAddCategory() {
            document.getElementById('add-category-form').classList.remove('hidden');
        }

        function hideAddCategory() {
            document.getElementById('add-category-form').classList.add('hidden');
            document.getElementById('new-category-name').value = '';
        }

        async function addCategory() {
            const name = document.getElementById('new-category-name').value.trim();
            if (!name) return;
            categories.push({
                id: Date.now(),
                name: name,
                items: []
            });
            await saveData();
            render();
            hideAddCategory();
        }

        async function deleteCategory(id) {
            if (confirm('Delete this category and all its items?')) {
                categories = categories.filter(c => c.id != id);
                await saveData();
                render();
            }
        }

        async function addItem(categoryId) {
            const input = document.getElementById(`item-input-${categoryId}`);
            const name = input.value.trim();
            if (!name) return;
            const cat = categories.find(c => c.id === categoryId);
            if (cat) {
                cat.items.push({
                    id: Date.now(),
                    name: name,
                    status: 'To Buy'
                });
                await saveData();
                render();
            }
        }

        async function updateItemStatus(categoryId, itemId, newStatus) {
            const cat = categories.find(c => c.id === categoryId);
            if (cat) {
                const item = cat.items.find(i => i.id === itemId);
                if (item) {
                    item.status = newStatus;
                    await saveData();
                    render();
                }
            }
        }

        async function deleteItem(categoryId, itemId) {
            const cat = categories.find(c => c.id == categoryId);
            if (cat) {
                cat.items = cat.items.filter(i => i.id != itemId);
                await saveData();
                render();
            }
        }

        function toggleCategory(categoryId) {
            if (collapsedCategories.has(categoryId)) {
                collapsedCategories.delete(categoryId);
            } else {
                collapsedCategories.add(categoryId);
            }
            render();
        }

        function updateStats() {
            let total = 0, toBuy = 0, procured = 0, packed = 0;
            categories.forEach(cat => {
                cat.items.forEach(item => {
                    total++;
                    if (item.status === 'To Buy') toBuy++;
                    else if (item.status === 'Already Procured') procured++;
                    else if (item.status === 'Packed') packed++;
                });
            });
            document.getElementById('total-items').textContent = total;
            document.getElementById('tobuy-items').textContent = toBuy;
            document.getElementById('procured-items').textContent = procured;
            document.getElementById('packed-items').textContent = packed;
        }

        function getStatusClass(status) {
            if (status === 'To Buy') return 'status-tobuy';
            if (status === 'Already Procured') return 'status-procured';
            return 'status-packed';
        }

        function render() {
            const container = document.getElementById('categories-container');
            container.innerHTML = '';

            categories.forEach(category => {
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'category';
                const isCollapsed = collapsedCategories.has(category.id);
                categoryDiv.innerHTML = `
                    <div class="category-header">
                        <h2>${category.name}</h2>
                        <div class="category-actions">
                            <button class="toggle-btn ${isCollapsed ? 'collapsed' : ''}" onclick="toggleCategory(${category.id})">‚ñº</button>
                            <button class="icon-btn" onclick="deleteCategory(${category.id})">üóëÔ∏è</button>
                        </div>
                    </div>
                    <div class="category-body ${isCollapsed ? 'collapsed' : ''}">
                        ${category.items.map(item => `
                            <div class="item">
                                <div class="item-content">
                                    <div class="item-name">${item.name}</div>
                                    <select class="item-status ${getStatusClass(item.status)}" onchange="updateItemStatus(${category.id}, ${item.id}, this.value)">
                                        <option value="To Buy" ${item.status === 'To Buy' ? 'selected' : ''}>To Buy</option>
                                        <option value="Already Procured" ${item.status === 'Already Procured' ? 'selected' : ''}>Already Procured</option>
                                        <option value="Packed" ${item.status === 'Packed' ? 'selected' : ''}>Packed</option>
                                    </select>
                                </div>
                                <div class="item-actions">
                                    <button onclick="deleteItem(${category.id}, ${item.id})">üóëÔ∏è</button>
                                </div>
                            </div>
                        `).join('')}
                        <div class="input-group">
                            <input type="text" id="item-input-${category.id}" placeholder="New item name" onkeypress="if(event.key==='Enter') addItem(${category.id})">
                            <button class="btn-success btn-small" onclick="addItem(${category.id})">‚ûï Add Item</button>
                        </div>
                    </div>
                `;
                container.appendChild(categoryDiv);
            });

            updateStats();
            
            // Hide setup notice if URL is configured
            if (SCRIPT_URL !== 'YOUR_SCRIPT_URL_HERE') {
                const notice = document.getElementById('setup-notice');
                if (notice) notice.style.display = 'none';
            }
        }

        // Auto-refresh every 30 seconds to see updates from others
        setInterval(() => {
            if (!isLoading && SCRIPT_URL !== 'YOUR_SCRIPT_URL_HERE') {
                loadData();
            }
        }, 30000);

        // Load data on page load
        loadData();
    </script>
</body>
</html>